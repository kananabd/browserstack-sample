const a71_0x875771=a71_0x564c;function a71_0x564c(_0x267fb1,_0x2e63c2){const _0x2a033c=a71_0x2a03();return a71_0x564c=function(_0x564c57,_0x4a715b){_0x564c57=_0x564c57-0x1ab;let _0x5e17c6=_0x2a033c[_0x564c57];return _0x5e17c6;},a71_0x564c(_0x267fb1,_0x2e63c2);}(function(_0x506659,_0x2e6e82){const _0x5c1c6b=a71_0x564c,_0xddc61d=_0x506659();while(!![]){try{const _0x5b10c2=parseInt(_0x5c1c6b(0x1c2))/0x1*(parseInt(_0x5c1c6b(0x1c5))/0x2)+-parseInt(_0x5c1c6b(0x1d1))/0x3*(parseInt(_0x5c1c6b(0x1bc))/0x4)+-parseInt(_0x5c1c6b(0x1f9))/0x5+parseInt(_0x5c1c6b(0x1f3))/0x6+parseInt(_0x5c1c6b(0x1e8))/0x7*(-parseInt(_0x5c1c6b(0x1f4))/0x8)+parseInt(_0x5c1c6b(0x1f6))/0x9+parseInt(_0x5c1c6b(0x1d2))/0xa;if(_0x5b10c2===_0x2e6e82)break;else _0xddc61d['push'](_0xddc61d['shift']());}catch(_0x5466bb){_0xddc61d['push'](_0xddc61d['shift']());}}}(a71_0x2a03,0x8e425));function a71_0x2a03(){const _0x4994c2=['580417dDMuiI','assign','app:exec','2MmjFpo','jELfI','BROWSERSTACK_TESTHUB_UUID','Percy\x20healthcheck\x20successful','stringify','winstonLogger','percy/healthcheck','healthcheck','automate','nqWfU','version','createPercyConfig','865479YtaaYK','2760300rrZFsW','jOjnT','data','exec:stop','AVtmx','path','nodeRequest','Error\x20creating\x20percy\x20config:\x20','Tcnkw','pipe','push','../../helpers/testhub/constants','ebdYY','getBinaryPath','../../helpers/performance/constants','env','http://localhost:5338','writeFile','ENV_VAR','start','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','VkECI','7GGSmzq','Percy\x20config\x20created\x20at\x20','percy.log','MBORk','NDzNB','IrpcK','YZyRM','./PercyBinary','LWdUU','api/app_percy/get_project_token?name=','PERCY_SERVER_ADDRESS','4450638mbmJSO','7031184TRExKi','../helper','5645358zvtyBU','close','stdout','2376990RpshXj','projectName','flags','kqNJD','stderr','DOWNLOAD','end','isProcessRunning','percy.json','exec','djbwT','createWriteStream','GET','exports','vUfRg','&type=','join','app','hsBnx','../../helpers/performance/performance-tester','child_process','UdacI','stop','WcMms','percyOptions','4NNCavc','tmpdir','fetchPercyToken','error','SrpGm','debug'];a71_0x2a03=function(){return _0x4994c2;};return a71_0x2a03();}const fs=require('fs'),path=require(a71_0x875771(0x1d7)),os=require('os'),{spawn}=require(a71_0x875771(0x1b7)),helper=require(a71_0x875771(0x1f5)),logger=require('../logger')[a71_0x875771(0x1ca)],{logDir}=require('../logger'),testHubConstants=require(a71_0x875771(0x1dd)),PerformanceTester=require(a71_0x875771(0x1b6)),{PERCY_EVENTS:PerformanceEvents}=require(a71_0x875771(0x1e0)),PercyBinary=require(a71_0x875771(0x1ef));class Percy{#logfile=path[a71_0x875771(0x1b3)](logDir,a71_0x875771(0x1ea));#address=process[a71_0x875771(0x1e1)][a71_0x875771(0x1f2)]||a71_0x875771(0x1e2);#binaryPath=null;#config=null;#proc=null;#isApp=![];['isProcessRunning']=![];constructor(_0x1a4530){this.#config=_0x1a4530,!!_0x1a4530['app']&&(this.#isApp=!![]);}async #getBinaryPath(){const _0xc733d3=a71_0x875771;if(!this.#binaryPath){const _0x20e821=new PercyBinary();PerformanceTester[_0xc733d3(0x1e5)](PerformanceEvents[_0xc733d3(0x1fe)]),this.#binaryPath=await _0x20e821[_0xc733d3(0x1df)](this.#config),PerformanceTester[_0xc733d3(0x1ff)](PerformanceEvents[_0xc733d3(0x1fe)]);}return this.#binaryPath;}async #sleep(_0x2b0d64){return new Promise(_0x24825c=>setTimeout(_0x24825c,_0x2b0d64));}async[a71_0x875771(0x1cc)](){const _0x431f17=a71_0x875771,_0xdde8c9={};_0xdde8c9[_0x431f17(0x1ad)]=_0x431f17(0x1af),_0xdde8c9['MBORk']=_0x431f17(0x1cb);const _0x4cca56=_0xdde8c9;try{const _0x51f3f2=await helper[_0x431f17(0x1d8)](_0x4cca56[_0x431f17(0x1ad)],_0x4cca56[_0x431f17(0x1eb)],null,null,this.#address);if(_0x51f3f2)return!![];}catch(_0x1e3256){return![];}}async['start'](){const _0x52bfa3=a71_0x875771,_0x536e0e={'hsBnx':_0x52bfa3(0x1c4),'WcMms':_0x52bfa3(0x1ac),'UdacI':function(_0x3fd57c,_0x18e9af,_0x3b1591,_0x24269c){return _0x3fd57c(_0x18e9af,_0x3b1591,_0x24269c);},'LWdUU':'close','jOjnT':_0x52bfa3(0x1c8)},_0x2b1b53=await this.#getBinaryPath(),_0x4872c9={};_0x4872c9[_0x52bfa3(0x1fb)]='a';const _0x5bc610=fs[_0x52bfa3(0x1ae)](this.#logfile,_0x4872c9),_0x4c69b8=await this[_0x52bfa3(0x1be)](),_0xef3f49=await this[_0x52bfa3(0x1d0)]();if(!_0x4c69b8)return![];const _0x26f39d=[(this.#isApp?_0x536e0e[_0x52bfa3(0x1b5)]:_0x536e0e[_0x52bfa3(0x1ba)])+':start'];_0xef3f49&&_0x26f39d[_0x52bfa3(0x1dc)]('-c',_0xef3f49);this.#proc=_0x536e0e[_0x52bfa3(0x1b8)](spawn,_0x2b1b53,_0x26f39d,{'env':Object[_0x52bfa3(0x1c3)](process[_0x52bfa3(0x1e1)],{'PERCY_TOKEN':_0x4c69b8,'TH_BUILD_UUID':process['env'][testHubConstants[_0x52bfa3(0x1e4)][_0x52bfa3(0x1c7)]]})}),this.#proc[_0x52bfa3(0x1f8)][_0x52bfa3(0x1db)](_0x5bc610),this.#proc[_0x52bfa3(0x1fd)]['pipe'](_0x5bc610),this[_0x52bfa3(0x200)]=!![];var _0x3569df=this;this.#proc['on'](_0x536e0e[_0x52bfa3(0x1f0)],function(_0x5c0ba8){const _0x356a06=_0x52bfa3;_0x3569df[_0x356a06(0x200)]=![];});do{const _0x5dc23a=await this[_0x52bfa3(0x1cc)]();if(_0x5dc23a)return logger['debug'](_0x536e0e[_0x52bfa3(0x1d3)]),!![];await this.#sleep(0x3e8);}while(this[_0x52bfa3(0x200)]);return![];}async[a71_0x875771(0x1b9)](){const _0x4652d2=a71_0x875771,_0x2199eb={'NDzNB':function(_0x21e79c,_0x271be7){return _0x21e79c(_0x271be7);},'jELfI':function(_0x172870,_0x14fe8e,_0xa28092){return _0x172870(_0x14fe8e,_0xa28092);},'YZyRM':_0x4652d2(0x1d5),'vUfRg':_0x4652d2(0x1f7)},_0x4757f4=await this.#getBinaryPath();return new Promise((_0x42c2fc,_0xbe5f19)=>{const _0x19d303=_0x4652d2,_0x2547e8={'LpklW':function(_0x40fa63,_0x1a39b6){const _0x53e8ce=a71_0x564c;return _0x2199eb[_0x53e8ce(0x1ec)](_0x40fa63,_0x1a39b6);}},_0x3cdbf4=_0x2199eb[_0x19d303(0x1c6)](spawn,_0x4757f4,[_0x2199eb[_0x19d303(0x1ee)]]);_0x3cdbf4['on'](_0x2199eb[_0x19d303(0x1b1)],_0xb9882b=>{const _0x377ce6=_0x19d303;this[_0x377ce6(0x200)]=![],_0x2547e8['LpklW'](_0x42c2fc,_0xb9882b);});});}['isRunning'](){const _0x2e522d=a71_0x875771;return this[_0x2e522d(0x200)];}async[a71_0x875771(0x1be)](){const _0x2f4c2f=a71_0x875771,_0x74267b={};_0x74267b[_0x2f4c2f(0x1fc)]=_0x2f4c2f(0x1b4),_0x74267b['sBYEg']=_0x2f4c2f(0x1cd),_0x74267b[_0x2f4c2f(0x1d6)]=_0x2f4c2f(0x1af),_0x74267b['nqWfU']='Percy\x20fetch\x20token\x20success';const _0x256bf5=_0x74267b,_0x51782a=this.#config[_0x2f4c2f(0x1fa)];try{const _0x3bfc0a=this.#isApp?_0x256bf5[_0x2f4c2f(0x1fc)]:_0x256bf5['sBYEg'],_0x91c9a1=await helper[_0x2f4c2f(0x1d8)](_0x256bf5['AVtmx'],_0x2f4c2f(0x1f1)+_0x51782a+_0x2f4c2f(0x1b2)+_0x3bfc0a,{},this.#config),_0x3d0603=_0x91c9a1[_0x2f4c2f(0x1d4)];return logger[_0x2f4c2f(0x1c1)](_0x256bf5[_0x2f4c2f(0x1ce)]),_0x3d0603['token'];}catch(_0x5d3cd6){return logger[_0x2f4c2f(0x1bf)](_0x2f4c2f(0x1e6)+_0x5d3cd6),null;}}async['createPercyConfig'](){const _0x2fc9f2=a71_0x875771,_0x1a0a4b={'VkECI':function(_0x52750e,_0x32a08c){return _0x52750e(_0x32a08c);},'Tcnkw':function(_0x26b445,_0x502b1a){return _0x26b445+_0x502b1a;},'IrpcK':_0x2fc9f2(0x1e9),'ebdYY':_0x2fc9f2(0x1ab)};if(!this.#config[_0x2fc9f2(0x1bb)])return null;const _0x11bce9=path[_0x2fc9f2(0x1b3)](os[_0x2fc9f2(0x1bd)](),_0x1a0a4b[_0x2fc9f2(0x1de)]),_0xe4100c=this.#config[_0x2fc9f2(0x1bb)];return!_0xe4100c['version']&&(_0xe4100c[_0x2fc9f2(0x1cf)]='2'),new Promise((_0x2e75b9,_0x4186f5)=>{const _0x3f0755=_0x2fc9f2,_0x483c7f={'SrpGm':function(_0x5f15ea,_0xad17a3){const _0x21bbfe=a71_0x564c;return _0x1a0a4b[_0x21bbfe(0x1e7)](_0x5f15ea,_0xad17a3);},'DQlBn':function(_0x372d85,_0x8a9d53){const _0x364ee1=a71_0x564c;return _0x1a0a4b[_0x364ee1(0x1da)](_0x372d85,_0x8a9d53);},'VpfWZ':_0x1a0a4b[_0x3f0755(0x1ed)]};fs[_0x3f0755(0x1e3)](_0x11bce9,JSON[_0x3f0755(0x1c9)](_0xe4100c),_0x5711aa=>{const _0x13bf3e=_0x3f0755;_0x5711aa&&(logger[_0x13bf3e(0x1bf)](_0x13bf3e(0x1d9)+_0x5711aa),_0x483c7f[_0x13bf3e(0x1c0)](_0x2e75b9,null)),logger['debug'](_0x483c7f['DQlBn'](_0x483c7f['VpfWZ'],_0x11bce9)),_0x483c7f[_0x13bf3e(0x1c0)](_0x2e75b9,_0x11bce9);});});}}module[a71_0x875771(0x1b0)]=Percy;